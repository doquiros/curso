<!DOCTYPE html>
<html>
<head>
<title>Ejemplo</title>
<meta charset="utf-8">
<style>
	body {
		border: 1px solid cadetblue;
		width: 20em;
		padding: 0em 1em 1em 1em;
	}
	#answer-box {
		border: 1px solid cadetblue;
		font-size: 20px;
		font-family: "Open Sans", sans-serif;
	}
	#op-buttons {
		display: grid;
		grid-template-columns: repeat(5, 1fr);
		grid-template-rows: repeat(3, 1fr);
		grid-template-areas:
			"mas menos por entre elevado"
			"cuadrado inversa raiz entera null"
			"igual igual igual igual igual";
		grid-gap: 1rem;
	}
	#mas { grid-area: mas; }
	#menos { grid-area: menos; }
	#por { grid-area: por; }
	#entre { grid-area: entre; }
	#elevado { grid-area: elevado; }
	#cuadrado { grid-area: cuadrado; }
	#inversa { grid-area: inversa; }
	#raiz { grid-area: raiz; }
	#entera { grid-area: entera; }
	#igual { grid-area: igual; }
</style>
<script type="text/javascript">
	/* Asociamos un numero a cada operacion:
	 * suma: 0
	 * resta: 1
	 * producto: 2
	 * division: 3
	 * potenciacion: 4
	 * cuadrado: 5
	 * inversa: 6
	 * raiz: 7
	 * parte entera: 8
	 * 
	 * Y otro numero para el tipo de operacion:
	 * unaria: 0
	 * binaria: 1
	 */

	var num, acc = 0, next_op = -1;
	var op2optype = [1, 1, 1, 1, 1, 0, 0, 0, 0];
	
	// Para las operaciones binarias se puede usar el teclado:
	var symbol2op = {"+":0, "-":1, "*":2, "/":3, "^": 4}
	function dbg(msg) {
		document.getElementById("dbg").innerHTML = document.getElementById("dbg").innerHTML + "<br\> :" + msg;
	}
	
	function vaciar () {num.value = "";}
	function show_acc()	{	document.getElementById("answer").innerHTML = acc.toString();	}
	function clear_input()	{	num.value = "";	}

	function bindKeys()
	{
		// Vamos a usar el teclado para introducir los numeros y las operaciones binarias. 
		// Las unarias tendran que hacerse obligatoriamente pulsando el boton correspondiente con el raton.
		document.onkeypress = function(e){
			switch (e.keyCode){
				case 0x0d: // tecla enter: igual
					num.blur(0);
					igual();
					break;
				case 0x2a: // tecla *: suma
				case 0x2b: // tecla +: suma
				case 0x2d: // tecla -: resta
				case 0x2f: // tecla /: division
				case 0x5e: // tecla ^: potenciacion
					if(num.value !== "")
					{
						num.blur(0);
						calcular(symbol2op[String.fromCharCode(e.keyCode)]);
					}
					break;
			}

			if((e.keyCode >= 0x30 && e.keyCode < 0x40) || e.keyCode === 0x2e || e.keyCode === 0x2d)
			{
				
				if(num.value === "0")
				{
					num.value = String.fromCharCode(e.keyCode);
				}
				else
				{
					num.value += String.fromCharCode(e.keyCode);
				}
				num.focus();
				
			}
		};
	}
	
	function calcular(op) {

		dbg("calcular");


		if(op2optype[op] === 1)
			do_op = next_op;
		else
			do_op = op;
		// Cargar nuevo valor, ejecutando la operacion que nos ordenaron:
		switch(do_op)
		{
			case -1: //asignacion
				acc = +num.value;
				break;
			case 0: //suma
				acc = +acc + +num.value;
				break;
			case 1: //resta
				acc = +acc - +num.value;
				break;
			case 2:  //producto
				acc = +acc * +num.value;
				break;
			case 3:  //division
				acc = +acc / +num.value;
				break;
			case 4:  //potenciacion
				acc = (+acc) ** (+num.value);
				break;
			case 5: //cuadrado
				acc = (+num.value) ** 2;
				break;
			case 6: //inversa
				acc = 1 / (+num.value);
				break;
			case 7: //raiz
				acc = Math.sqrt(+num.value);
				break;
			case 8: //parte entera
				acc = (+num.value) >= 0? Math.floor(num.value) : Math.ceil(num.value);
				break;
			default:
				return;
		}
		acc = acc.toString();

		//Guardamos la operacion a ejecutar con el siguiente valor introducido
		if(op2optype[op] === 1)
			next_op = op;
		else
			next_op = -1;
		//mostramos el resultado
		show_acc();
		//limpiamos la caja de entrada
		clear_input();

	}

	function igual() {
		calcular(next_op);
		acc = 0;
		next_op = -1;
	}

	function inic ()
	{
		num = document.getElementById("num");
		bindKeys();
	}

</script>
</head>
<body onLoad="inic()">
	<p id="answer-box">Result: <span id="answer"> 0</span></p>
	NÃºmero:<p>
	<input autofocus type="text" pattern="[0-9.+-]*" size="12" id="num" onClick="vaciar()" onInput="dbg()" readonly="readonly"/><p>
	</p>
	<div id="op-buttons">
	<button id="mas" onClick="calcular(0)">+</button>
	<button id="menos" onClick="calcular(1)">-</button>
	<button id="por" onClick="calcular(2)">*</button>
	<button id="entre" onClick="calcular(3)">/</button>
	<button id="elevado" onClick="calcular(4)">x^y</button>	
	<button id="cuadrado" onClick="calcular(5)">x<super>2</super></button>
	<button id="inversa" onClick="calcular(6)">1/x</button>
	<button id="raiz" onClick="calcular(7)">sqrt(x)</button>
	<button id="entera" onClick="calcular(8)">int(x)</button>
	<button id="igual" onClick="igual()">=</button>
	</div>
	<div id="dbg"></div>
</body>
</html>
